# 微信小程序开发环境设置指南

## 🚨 域名限制问题解决方案

### 问题描述
```
http://127.0.0.1:8000 不在以下 request 合法域名列表中，请参考文档...
```

这是微信小程序的安全限制，只能请求后台配置的合法域名。

## 🛠️ 解决方案

### 方法1：关闭域名校验（开发环境推荐）

**步骤：**
1. 打开微信开发者工具
2. 点击右上角的 **"详情"** 按钮
3. 切换到 **"本地设置"** 标签页
4. 勾选 **"不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"**

![设置位置](https://developers.weixin.qq.com/miniprogram/dev/image/devtools2/setting.png)

### 方法2：使用真实域名（生产环境）

**后台配置步骤：**
1. 登录微信公众平台：https://mp.weixin.qq.com
2. 进入 **开发 > 开发管理 > 开发设置**
3. 在 **服务器域名** 中添加：
   - request合法域名：`https://your-domain.com`
   - file合法域名：`https://your-domain.com`

## 🔧 项目配置说明

### 环境自动切换
项目已配置多环境支持：

```javascript
// utils/config.js
const envConfig = {
  develop: {  // 开发环境
    baseURL: 'http://127.0.0.1:8000/api'
  },
  trial: {    // 体验版
    baseURL: 'https://your-test-domain.com/api'
  },
  release: {  // 正式版
    baseURL: 'https://your-production-domain.com/api'
  }
}
```

### 智能错误提示
- 域名错误时自动提示设置方法
- 网络错误时提示检查Django服务
- 开发环境专用调试信息

## 🚀 开发流程

### 1. 启动后端服务
```bash
cd Smart_restaurant
python manage.py runserver 127.0.0.1:8000
```

### 2. 配置微信开发者工具
- 关闭域名校验（见方法1）
- 确保项目路径正确

### 3. 测试API连接
- 打开小程序调试器
- 查看Network面板确认请求正常

## 📝 常见问题

### Q: 还是提示域名错误？
A: 确保已勾选"不校验合法域名"选项，并重启开发者工具

### Q: 显示网络连接失败？
A: 检查Django服务是否在运行：`python manage.py runserver`

### Q: 生产环境如何配置？
A: 需要：
1. 部署Django到有SSL证书的服务器
2. 在微信后台配置合法域名
3. 修改`utils/config.js`中的生产环境URL

## 🎯 下一步

1. ✅ 关闭域名校验
2. ✅ 启动Django服务
3. ✅ 测试小程序功能
4. 📋 准备生产环境域名

---

**提示：** 开发完成后记得配置生产环境的合法域名！ 