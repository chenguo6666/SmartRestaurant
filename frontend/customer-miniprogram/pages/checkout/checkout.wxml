<!--订单确认页面-->
<view class="page-container">
  <!-- 头部栏 -->
  <view class="header">
    <view class="header-title">订单确认</view>
  </view>

  <!-- 主容器 -->
  <view class="container">
    <!-- 加载状态 -->
    <view wx:if="{{loading}}" class="loading-container">
      <view class="loading-text">加载中...</view>
    </view>

    <!-- 订单商品 -->
    <view wx:else class="section">
      <view class="section-title">订单商品</view>
      <view 
        class="order-item" 
        wx:for="{{orderItems}}" 
        wx:key="dish_id"
      >
        <view class="order-item-name">{{item.dish_name}}</view>
        <view class="order-item-quantity">×{{item.quantity}}</view>
        <view class="order-item-price">¥{{item.dish_price}}</view>
      </view>
    </view>

    <!-- 优惠信息 -->
    <view class="section">
      <view class="section-title">优惠信息</view>
      <view class="coupon-select" bindtap="onSelectCoupon">
        <text>优惠券</text>
        <view class="coupon-right">
          <text class="coupon-text">{{selectedCoupon ? selectedCoupon.name : '暂无可用'}}</text>
          <text class="coupon-arrow">></text>
        </view>
      </view>
    </view>

    <!-- 桌号信息 -->
    <view class="section">
      <view class="section-title">桌号信息</view>
      <input 
        class="table-input" 
        placeholder="请输入桌号（选填）" 
        value="{{tableNumber}}"
        bindinput="onTableNumberInput"
      />
    </view>

    <!-- 订单金额 -->
    <view class="section">
      <view class="section-title">订单金额</view>
      <view class="price-detail">
        <text>商品总额</text>
        <text>¥{{totalAmount}}</text>
      </view>
      <view class="price-detail" wx:if="{{discountAmount > 0}}">
        <text>优惠金额</text>
        <text class="discount-amount">-¥{{discountAmount}}</text>
      </view>
      <view class="price-detail price-total">
        <text>应付总计</text>
        <text>¥{{finalAmount}}</text>
      </view>
    </view>

    <!-- 备注 -->
    <view class="section">
      <view class="section-title">备注</view>
      <textarea 
        class="remark-input" 
        placeholder="请输入口味偏好、特殊要求等"
        value="{{customerNotes}}"
        bindinput="onNotesInput"
        maxlength="200"
      ></textarea>
      <view class="remark-count">{{customerNotes.length}}/200</view>
    </view>
  </view>

  <!-- 结算栏 -->
  <view class="checkout-bar">
    <view class="total-info">
      <text class="total-label">应付：</text>
      <text class="total-price">¥{{finalAmount}}</text>
    </view>
    <button 
      class="submit-btn" 
      bindtap="onSubmitOrder"
      disabled="{{submitting}}"
    >
      {{submitting ? '提交中...' : '提交订单'}}
    </button>
  </view>
</view>

<!-- 优惠券选择弹窗 -->
<view wx:if="{{showCouponModal}}" class="modal-mask" bindtap="onCloseCouponModal">
  <view class="coupon-modal" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">选择优惠券</text>
      <text class="modal-close" bindtap="onCloseCouponModal">×</text>
    </view>
    
    <scroll-view class="coupon-list" scroll-y>
      <view 
        class="coupon-item {{selectedCoupon && selectedCoupon.id === item.id ? 'selected' : ''}}"
        wx:for="{{availableCoupons}}" 
        wx:key="id"
        bindtap="onCouponSelect"
        data-coupon="{{item}}"
      >
        <view class="coupon-info">
          <view class="coupon-name">{{item.name}}</view>
          <view class="coupon-desc">{{item.description}}</view>
          <view class="coupon-condition">满{{item.min_order_amount}}元可用</view>
        </view>
        <view class="coupon-value">¥{{item.discount_amount}}</view>
      </view>
      
      <view wx:if="{{availableCoupons.length === 0}}" class="no-coupon">
        <text>暂无可用优惠券</text>
      </view>
    </scroll-view>
    
    <view class="modal-footer">
      <button class="coupon-confirm-btn" bindtap="onConfirmCoupon">确定</button>
    </view>
  </view>
</view> 